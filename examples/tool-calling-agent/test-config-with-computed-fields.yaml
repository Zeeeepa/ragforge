name: test-computed-fields
version: 1.0.0

entities:
  - name: Scope
    unique_field: uuid
    searchable_fields:
      - name: name
        type: string
        description: Scope name (function/class/method)
      - name: file
        type: string
        description: File path
      - name: type
        type: string
        description: Scope type (function, class, method)
      - name: startLine
        type: number
        description: Starting line number
      - name: endLine
        type: number
        description: Ending line number
      - name: source
        type: string
        description: Full source code

    # Phase 3: Computed fields
    computed_fields:
      - name: line_count
        type: number
        description: Number of lines in this scope
        expression: endLine - startLine + 1

      - name: is_large
        type: boolean
        description: Whether this scope is large (>100 lines)
        expression: (endLine - startLine + 1) > 100

      - name: char_count
        type: number
        description: Number of characters in source code
        expression: source.length
        materialized: true
        cache_property: cached_char_count

      - name: change_count
        type: number
        description: Number of changes tracked for this scope
        cypher: |
          OPTIONAL MATCH (n)-[:HAS_CHANGE]->(c:Change)
          RETURN count(c)

    relationships:
      - type: CONSUMES
        target: Scope
        direction: outgoing
